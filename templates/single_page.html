<!DOCTYPE html>
<html lang="{{ get_locale() }}">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

  <title>Keerikandy Family</title>
  <style>
  /* Malayalam (ml) language-specific layout tweaks without changing font */
html[lang="ml"] body {
  letter-spacing: 0.4px;
  word-spacing: 1px;
  line-height: 1.75;
}

html[lang="ml"] .btn {
  padding: 12px 20px;
  font-size: 0.8rem;
  white-space: normal;
  text-align: center;
}

html[lang="ml"] .container h2,
html[lang="ml"] .first-profile-container h2,
html[lang="ml"] .contain h2 {
  font-size: 1.1rem;
  letter-spacing: 0.3px;
}

html[lang="ml"] .site-title {
  font-size: 1.54rem;
}

/* ‚úÖ Corrected media query block */
@media (max-width: 600px) {
  html[lang="ml"] .site-title {
    font-size: 1.38rem;
  }
  
  html[lang="ml"] .btn {
    font-size: 0.6rem; /* 0.2rem was too small; adjust as needed */
  }
    html[lang="ml"] .btn btn-primary {
    font-size: 0.3rem; /* 0.2rem was too small; adjust as needed */
  }
  
}


  html, body {
  margin: 0;
  padding: 0;
}

html {
  font-size: 16px;
}

/* Root theme colors */
:root {
  --primary: #0077b6;
  --primary-dark: #005f91;
  --secondary: #6c757d;
  --secondary-dark: #545b62;
  --warning: #f39c12;
  --warning-dark: #d78b0d;
  --background: #f4f6f9;
  --white: #ffffff;
  --text: #333333;
  --light-border: #e0e0e0;
  --light-grey: #f9f9f9;
}

/* Global resets */
* {
  box-sizing: border-box;
}

body {
  margin: 0;
background: #f0f0f0;
  font-family: 'Segoe UI', sans-serif;
  color: var(--text);
  line-height: 1.5;
}

/* Headings */
header, h1, h2, h3, h4 {
  color: var(--primary);
  margin: 0 0 20px;
}

/* Site Header */
.site-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--primary);
  color: var(--white);
  padding: 12px 16px;
  width: 100%;
}

.menu-btn {
  background: none;
  border: none;
  color: var(--white);
  cursor: pointer;
  font-size: 1.4rem;
  width: 48px;
  height: 24px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  margin: 0;
}

.menu-btn:hover {
  color: var(--primary-dark);
}

.site-title {
  flex: none;
  text-align: center;
  font-size: 1.8rem;
  font-weight: bold;
  margin-left: 15px;

  
}

.menu-placeholder {
  display: inline-block;
  width: 48px;
  height: 24px;
}

/* Container */
.container {
  max-width: 960px;
  margin: 40px auto;
  background: var(--white);
  padding: 30px;
  border-radius: 12px;
  box-shadow: 0px 4px 30px rgba(0, 0, 0, 0.08);
  border: 1px solid #e0e0e0;
}

/* Buttons */
.btn {
  display: inline-block;
  padding: 10px 20px;
  margin: 10px 5px 0 0;
  border: none;
  border-radius: 4px;
  text-decoration: none;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.3s ease, color 0.3s ease;
}

.btn-primary {
  background: var(--primary);
  color: var(--white);
}

.btn-primary:hover {
  background: var(--primary-dark);
}

.btn-warning {
  background: var(--warning);
  color: var(--white);
}

.btn-warning:hover {
  background: var(--warning-dark);
}

.btn-secondary {
  background: var(--secondary);
  color: var(--white);
}

.btn-secondary:hover {
  background: var(--secondary-dark);
}

/* Messages */
.message {
  background: #e2f0fb;
  border: 1px solid #b3d7f0;
  padding: 12px;
  border-radius: 4px;
  margin-bottom: 20px;
  color: var(--primary);
}

/* User Info */
.user-info {
  background: #f8f9fa;
  padding: 15px;
  border-radius: 5px;
  margin-bottom: 20px;
  border-left: 5px solid var(--primary);
}

.user-info p {
  margin: 0;
}

/* Form Elements */
input, select, button {
  font-size: 1rem;
  padding: 10px;
  margin: 10px 0;
  border: 1px solid var(--light-border);
  border-radius: 4px;
  width: 100%;
}

/* Tables */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

table th,
table td {
  border: 1px solid var(--light-border);
  padding: 12px 15px;
  text-align: left;
}

table th {
  background: var(--primary);
  color: var(--white);
}

table tr:nth-child(even) {
  background: var(--light-grey);
}

table tr:hover {
  background: #f1f1f1;
}

/* Overlay for images */
#imageOverlay {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  justify-content: center;
  align-items: center;
  z-index: 9999;
  padding: 20px;
}

#imageOverlay img {
  max-width: 90%;
  max-height: 80%;
  border: 4px solid #fff;
  border-radius: 8px;
}

#imageOverlay .close-btn {
  position: absolute;
  top: 20px;
  right: 30px;
  color: #fff;
  font-size: 30px;
  cursor: pointer;
  font-weight: bold;
}

/* Sidebar */
#sidebar {
  position: fixed;
  top: 0;
  left: -250px;
  width: 250px;
  height: 100%;
  background: var(--primary);
  color: #fff;
  padding-top: 60px;
  transition: left 0.3s ease;
  z-index: 9999;
}

#sidebar a {
  display: block;
  color: #fff;
  padding: 15px 20px;
  text-decoration: none;
  font-weight: 600;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

#sidebar a:hover {
  background: var(--primary-dark);
}

#sidebar #closeBtn {
  position: absolute;
  top: 20px;
  right: 20px;
  font-size: 28px;
  cursor: pointer;
}

#sidebar a.active-sidebar {
  background: #28a745;
  color: #fff;
}


/* üîî Notification */
.admin-actions {
  background: #fff3cd;
  border-left: 5px solid var(--warning);
  padding: 15px;
  border-radius: 5px;
  margin-top: 20px;
}

.admin-actions h3 {
  margin-top: 0;
  color: var(--warning-dark);
}

/* Responsive styles */
@media (max-width: 600px) {
  html {
    font-size: 16px;
  }

  .site-header {
    padding: 12px;
  }

  .site-title {
    font-size: 1.6rem;
    margin-right: 15px;
  }

  .menu-btn {
    font-size: 1.2rem;
    width: 36px;
    height: 24px;
  }

  .menu-placeholder {
    width: 36px;
  }

  .btn {
    width: 100%;
    margin: 12px 0;
    font-size: 1.2rem;
    padding: 14px 20px;
  }

  input, select, button {
    font-size: 1.1rem;
    padding: 14px 16px;
  }

  .container {
  width: 97%;
  margin: 0px auto;
  padding: 20px;
  background: var(--white);
  box-shadow: var(--shadow);
  border: 1px solid var(--light-border);
  border-radius: 8px;
}
.container h2 {
  color: var(--primary);
  font-size: 1.2rem;
  font-weight: bold;
  text-align: center;
  margin-bottom: 20px;
  letter-spacing: 0.5px;
}

  .table-responsive {
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    border-radius: 6px;
    border: 1px solid var(--light-border);
  }

  table {
    min-width: 750px;
    border-collapse: collapse;
  }

table th,
table td {
  padding: 4px 8px;     /* less vertical padding */
  font-size: 0.85rem;
  line-height: 1.2;
}


  table th {
    background: var(--primary);
    color: var(--white);
    font-weight: bold;
  }

  table tr:nth-child(even) {
    background: var(--light-grey);
  }

  table tr:hover {
    background: #f1f1f1;
  }
}

.shift-right {
  margin-left: 0px;
}

@media (max-width: 600px) {
  .shift-right {
    margin-left: 15px;
  }
  .container .btn.btn-primary {
  padding: 6px 12px;
  font-size: 0.85rem;
  border-radius: 4px;
  display: inline-block;
  width: 130px;       /* or whatever size you prefer */
}


}
/* First Profile Container */
.first-profile-container {
  max-width: 600px;
  margin: 60px auto;
  background: var(--white);
  padding: 40px;
  border-radius: 10px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  border: 1px solid var(--light-border);
  
}

.first-profile-container h2 {
  color: var(--primary);
  font-size: 1.8rem;
  font-weight: 700;
  margin-bottom: 30px;
  text-align: center;
  
}

.first-profile-container form {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.first-profile-container input[type="text"],
.first-profile-container button {
  font-size: 1rem;
  padding: 12px 16px;
  border-radius: 5px;
  border: 1px solid var(--light-border);
}

.first-profile-container input[type="text"]:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 2px rgba(0,123,182,0.2);
}

.first-profile-container button {
  background: var(--primary);
  color: var(--white);
  border: none;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.3s ease;
}

.first-profile-container button:hover {
  background: var(--primary-dark);
}

/* Video styling */
.first-profile-container video,
.first-profile-container canvas {
  width: 100%;
  max-width: 400px;
  margin: 0 auto;
  display: block;
  border-radius: 8px;
  border: 1px solid var(--light-border);
}

/* Responsive adjustments */
@media (max-width: 600px) {
  .first-profile-container {
    margin: 30px 10px;
    padding: 20px;
  }
  .first-profile-container h2 {
    font-size: 1.5rem;
  }
}
.contain {
  max-width: 600px;
  margin: 80px auto;
  padding: 40px 30px;
  background: var(--white);
  border-radius: 10px;
  box-shadow: 0 4px 25px rgba(0, 0, 0, 0.1);
  text-align: center;
  border: 1px solid var(--light-border);
}

.contain h2 {
  color: var(--primary);
  font-size: 1.8rem;
  font-weight: 700;
  margin-bottom: 20px;
}

.contain p {
  color: var(--secondary-dark);
  font-size: 1.1rem;
  margin-bottom: 0;
  line-height: 1.5;
}

/* Responsive adjustments */
@media (max-width: 600px) {
  .contain {
    margin: 40px 10px;
    padding: 25px 15px;
  }

  .contain h2 {
    font-size: 1.5rem;
  }

  .contain p {
    font-size: 1rem;
  }
  
}

  .birthday-box {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
background: linear-gradient(to right, #e0f7fa, #0077b6);

  border: 1px solid #fafafd;
  border-radius: 6px;
  text-align: center;
  position: relative;
  overflow: hidden;
  margin: 20px;
  width: 100%;
  margin-left: 0px;
}

.birthday-title {
  font-size: 1.8rem;
color: #f1f1f1; 
  margin-bottom: 15px;
  font-weight: bold;
}

.birthday-list {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 20px;
}

.birthday-card {
  background: white;
  padding: 10px;
  border-radius: 8px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  text-align: center;
  width: 120px;
}

.birthday-card img {
  width: 100%;
  height: 100px;
  object-fit: cover;
  border-radius: 6%;
}

.birthday-card .name {
  margin-top: 8px;
  font-weight: bold;
  color: #5c5756;
}
.birthday-card .age {
  font-size: 0.95rem;
  color: #777;
  background-color: #e6f7ff; /* Softest pleasant blue */

  padding: 2px 8px;
  border-radius: 10px;
  margin-top: 4px;
  text-align: center;
  font-weight: 600;
}

/* Confetti Animation */
.confetti {
  position: absolute;
  top: -10px;
  width: 10px;
  height: 10px;
  opacity: 0.7;
  animation: fall 3.4s linear infinite;
  border-radius: 50%;
  pointer-events: none;
  z-index: 10;
}

@keyframes fall {
  0% {
    transform: translateY(0) rotate(0deg);
    opacity: 1;
  }
  100% {
    transform: translateY(100vh) rotate(720deg);
    opacity: 0;
  }
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.02); }
  100% { transform: scale(1); }
}


.event-card {
  background-color: #ffffff;
  border-left: 5px solid var(--primary, #0077b6);
  padding: 1rem;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
  transition: transform 0.2s ease-in-out;
  word-wrap: break-word;
  overflow-wrap: break-word;
  white-space: normal;
  display: flex;
  flex-direction: column;
  height: auto;
  margin-bottom: 1.2rem;  /* üëà This adds space between cards */
}


.event-title,
.event-date,
.event-description {
  word-wrap: break-word;
  overflow-wrap: break-word;
  white-space: normal;
}

.event-title {
  font-size: 1.2rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  color: #333;
}

.event-date {
  font-size: 0.95rem;
  color: #0077b6;
  margin-bottom: 0.5rem;
  font-weight: bold;
}

.event-description {
  font-size: 0.95rem;
  color: #444;
  line-height: 1.4;
  font-weight: 500;
}

</style>


</head>
<body>

 <header class="site-header">
{% if mode != "login" and mode != "first_profile" and mode != "pending" %}
    <button id="menuBtn" class="menu-btn">‚ò∞</button>
  {% else %}
    <span class="menu-placeholder"></span>
  {% endif %}
<span class="site-title {% if mode == 'admin' %}shift-right{% endif %}">
  {{_('Keerikandy Family')}}
</span>
  {% if mode != "login" %}
    <span class="menu-placeholder"></span>
  {% else %}
    <span class="menu-placeholder"></span>
  {% endif %}
</header>

 {% if mode == "login" %}
  <div class="container">
    <h2>{{ _('Login') }}</h2>

   <!-- Language dropdown selector -->
<form method="POST" id="login-form">
  <!-- Language Selector -->
  <!-- <label for="language-select">{{ _('Language') }}</label>
  <select id="language-select">
    <option value="en" {% if session.get('lang') == 'en' %}selected{% endif %}>English</option>
    <option value="ml" {% if session.get('lang') == 'ml' %}selected{% endif %}>‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</option>
  </select> -->

  <!-- Email Input -->

  <!-- Invisible default submit button to force Enter to trigger login -->
  <button type="submit" name="action" value="login" style="display:none"></button>

  <input type="email" name="email" placeholder="{{ _('Email') }}" value="{{ email or '' }}" required><br>

  {% if otp_sent %}
    <input type="text" name="otp" placeholder="{{ _('Enter OTP') }}" value="{{ otp or '' }}" required><br>

    <!-- Resend OTP: visible but placed after login in HTML -->
    <div style="margin-bottom: 0px;">
     <button type="submit" name="action" value="send_otp" formnovalidate
  style="background:none;border:none;padding:0;color:#007bff;cursor:pointer;text-decoration:underline;
  margin-top:-30px;text-align:left;font-size: 0.80rem;">
  {{ _('Resend OTP') }}
</button>
    </div>

    <!-- Login button (visually last but triggers on Enter) -->
    <div>
      <button type="submit" name="action" value="login" class="btn btn-primary">{{ _('Login') }}</button>
      
    </div>

  {% else %}
    <button type="submit" name="action" value="send_otp" class="btn btn-primary">{{ _('Send OTP') }}</button>
     
  {% endif %}
</form>





<!-- JS to handle language change without clearing form -->
<script>
  document.getElementById('language-select').addEventListener('change', function () {
    const selectedLang = this.value;

    const form = document.getElementById('login-form');
    const email = form.querySelector('input[name="email"]').value;
    const otpField = form.querySelector('input[name="otp"]');
    const otp = otpField ? otpField.value : '';
    const action = form.querySelector('button[name="action"]').value;

    const params = new URLSearchParams();
    if (email) params.append('email', email);
    if (otp) params.append('otp', otp);
    if (action) params.append('action', action);
    params.append('lang', selectedLang);

    window.location.href = `/login?${params.toString()}`;
  });
</script>



  </div>
{% endif %}


 {% if mode == "first_profile" %}
  <div class="first-profile-container">
    <h2>{{_('First Login - Complete Your Profile')}}</h2>
    <form method="POST" onsubmit="return validateAndCaptureSelfie()">
      <input type="text" name="name" id="nameInput" placeholder="{{_('Full Name')}}" required>

      <video id="video" autoplay></video>
      <button type="button" onclick="takePhoto()">{{_('Capture Selfie')}}</button>
      <canvas id="canvas" width="320" height="240" class="hidden"></canvas>
      <input type="hidden" name="selfie" id="selfieInput">

      <button type="submit">{{_('Submit')}}</button>
    </form>
  </div>
{% endif %}

{% if mode == "pending" %}
  <div class="contain">
    <h2>{{_('Your account is awaiting admin approval')}}.</h2>
    <p>{{_('We‚Äôll notify you once it‚Äôs approved')}}.</p>
  </div>
{% endif %}

 {% if mode == "dashboard" and user %}


<div class="container">
  <h2>{{_('‚ú®Welcome')}}, {{ user.name }}!</h2>
  <div class="user-info">
   <p><strong>{{ _('Role') }}:</strong> {{ _(user.role) }}</p>

  </div>

  {% if user.role == "Admin" and (pending_count or 0) > 0 %}
    <div class="admin-actions">
      <h3>{{_('üîî Notification')}}</h3>
      <p>{{_('You have')}} <strong>{{ pending_count }}</strong> {{_('pending requests')}}.</p>
      <a href="{{ url_for('admin', filter='pending') }}" class="btn btn-warning">
        {{_('Manage/Approve Users')}}
      </a>
    </div>
  {% endif %}
{% if birthday_today %}
  <div class="birthday-box">
    <h2 class="birthday-title">üéâ Happy Birthday!</h2>
    <div class="birthday-list">
      {% for person in birthday_today %}
        <div class="birthday-card">
          {% if person.selfie_path %}
          <img src="{{ person.selfie_path or url_for('static', filename='default_profile.png') }}" alt="{{ person.name }}">
          {% else %}
        <img src="{{ url_for('static', filename='images/default_profile.jpeg') }}" alt="Selfie">
        {% endif %}
          <div class="name">{{ person.name }}</div>
          <div class="age">Age: {{ person.age }}</div>
        </div>
      {% endfor %}
    </div>
  </div>
{% endif %}
<h2 style="margin-top: 2rem;">üìÖ Upcoming Events</h2>

{% if events %}
<div class="event-cards-container">
  {% for event in events %}
    <div class="event-card">
      <div class="event-title">{{ event.title }}</div>
      <div class="event-date">üìÖ {{ event.date }}</div>
<div class="event-description">{{ event.description | safe }}</div>
    </div>
  {% endfor %}
</div>
{% else %}
<p style="margin-top: -10px; margin-left: 6px; font-weight: 500;">No events found.</p>
{% endif %}



  <div style="margin-top:20px;">
    {% if user.role in ["Admin", "Contributor", "Viewer"] %}
      <a href="{{ url_for('tree') }}" class="btn btn-primary">{{_('View Family Tree')}}</a>
    {% endif %}
  </div>
</div>
{% endif %}


  {% if mode == 'admin' %}
    <h2>{{_('User Management')}}</h2>

    <form method="get">
      <label>{{_('Filter')}}:</label>
      <select name="filter" onchange="this.form.submit()">
        <option value="all" {% if current_filter == 'all' %}selected{% endif %}>{{_('All Users')}}</option>
        <option value="pending" {% if current_filter == 'pending' %}selected{% endif %}>{{_('Pending Approvals')}}</option>
        <option value="approved" {% if current_filter == 'approved' %}selected{% endif %}>{{_('Approved Users')}}</option>
      </select>
    </form>
<div class="table-responsive">
    <table border="1" cellpadding="5" cellspacing="0" style="border-collapse: collapse; width: 100%; margin-top: 15px;">
      <tr>
        <th>{{_('Email')}}</th>
        <th>{{_('Name')}}</th>
        <th>{{_('Image')}}</th>
        <th>{{_('Role')}}</th>
        <th>{{_('Verified')}}</th>
        <th>{{_('Approved')}}</th>
        <th>{{_('Change Role')}}</th>
        <th>{{_('Action')}}</th>
      </tr>
      {% for user in users %}
      <tr>
        <td>{{ user.email }}</td>
        <td>{{ user.name }}</td>
        <td>
          {% if user.selfie_path %}
            <button
              type="button"
              class="btn btn-secondary"
                onclick="showOverlay('{{ user.selfie_path }}', '{{ user.email }}')"
            >
              {{_('Show Image')}}
            </button>
          {% else %}
            <p>{{_('No photo uploaded')}}.</p>
          {% endif %}
        </td>
        <td>{{ user.role }}</td>
        <td>{{ 'Yes' if user.is_verified else 'No' }}</td>
        <td>{{ 'Yes' if user.is_approved else 'No' }}</td>
        <td>
          <form method="post" style="display:inline;">
            <input type="hidden" name="user_id" value="{{ user.id }}">
            <select name="role">
              <option value="Viewer" {% if user.role == 'Viewer' %}selected{% endif %}>{{_('Viewer')}}</option>
              <option value="Contributor" {% if user.role == 'Contributor' %}selected{% endif %}>{{_('Contributor')}}</option>
              <option value="Admin" {% if user.role == 'Admin' %}selected{% endif %}>{{_('Admin')}}</option>
            </select>
            <button type="submit" name="action" value="update_role">{{_('Update')}}</button>
          </form>
        </td>
        <td>
          {% if user.email != SUPER_ADMIN_EMAIL and user.email != "razinmuhammed1999@gmail.com" %}
            {% if current_filter == 'pending' %}
              <form method="post" style="display:inline;">
                <input type="hidden" name="user_id" value="{{ user.id }}">
                <button type="submit" name="action" value="approve">{{_('Approve')}}</button>
              </form>
            {% endif %}
            <form method="post" style="display:inline;">
              <input type="hidden" name="user_id" value="{{ user.id }}">
              <button type="submit" name="action" value="delete">{{_('Delete')}}</button>
            </form>
          {% else %}
            {{_('Protected')}}
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </table>
    </div>
  {% endif %}

  <!-- Hidden overlay -->
  <div id="imageOverlay">
    <span class="close-btn" onclick="hideOverlay()">&times;</span>
    <img id="overlayImage" src="" alt="User Image">
  </div>

  <div id="current-user"
       data-email="{{ user.email if user else '' }}"
       data-role="{{ user.role if user else 'Admin' }}"
       style="display:none;"></div>

  <script>
    
function launchConfetti() {
  const box = document.querySelector('.birthday-box');
  if (!box) return;

  const boxWidth = box.clientWidth;

  for (let i = 0; i < 80; i++) {
    const confetti = document.createElement('div');
    confetti.classList.add('confetti');

    // Random size and color
    const size = Math.random() * 6 + 6;
    confetti.style.width = `${size}px`;
    confetti.style.height = `${size}px`;
    confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 70%)`;

    // Random position
    confetti.style.left = `${Math.random() * boxWidth}px`;
    confetti.style.top = `${Math.random() * -40}px`;

    // Set animation duration
    const duration = Math.random() * 3 + 5;
    confetti.style.animationDuration = `${duration}s`;

    box.appendChild(confetti);

    setTimeout(() => confetti.remove(), duration * 1000);
  }
}

// Example call (on page load or trigger)
window.addEventListener('DOMContentLoaded', launchConfetti);


    const currentUserElem = document.getElementById('current-user');
    const currentUserEmail = currentUserElem ? currentUserElem.getAttribute('data-email') : null;
    const currentUserRole = currentUserElem ? currentUserElem.getAttribute('data-role') : null;

   function showOverlay(imageUrl, imageOwnerEmail) {
    // Block ALL others from viewing this specific protected user
    if (imageOwnerEmail === "razinmuhammed1999@gmail.com" && currentUserEmail !== "razinmuhammed1999@gmail.com") {
        alert("You are not allowed to view this protected image.");
        return;
    }

    // Normal rules for other users
    if (currentUserRole !== "Admin" && currentUserEmail !== imageOwnerEmail) {
        alert("You are not allowed to view this image.");
        return;
    }

    document.getElementById('overlayImage').src = imageUrl;
    document.getElementById('imageOverlay').style.display = 'flex';
}


    function hideOverlay() {
      document.getElementById('imageOverlay').style.display = 'none';
    }
    document.getElementById("menuBtn")?.addEventListener("click", () => {
  document.getElementById("sidebar").style.left = "0";
});

document.getElementById("closeBtn")?.addEventListener("click", () => {
  document.getElementById("sidebar").style.left = "-250px";
});
  </script>
<div id="sidebar">
  <span id="closeBtn">&times;</span>
  
  <a href="{{ url_for('dashboard') }}"
     class="{% if mode == 'dashboard' %}active-sidebar{% endif %}">{{_('üè† Home')}}</a>
  
  <a href="{{ url_for('tree') }}"
     class="{% if mode == 'tree' %}active-sidebar{% endif %}">{{_('üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Tree')}}</a>


</a>
  {% if user.role == "Admin" %}
    <a href="{{ url_for('admin') }}"
       class="{% if mode == 'admin' %}active-sidebar{% endif %}">{{_('üë• Manage Users')}}</a>
    <a href="{{ url_for('show_events') }}"
   class="{% if mode == 'events' %}active-sidebar{% endif %}">
   {{ _('üóìÔ∏è Add/Edit Events') }}
  {% endif %}
  <a href="{{ url_for('bloodgroup_page') }}"
   class="{% if mode == 'bloodgroup' %}active-sidebar{% endif %}">
   {{_('ü©∏ Blood Group')}}
</a>

  <a href="{{ url_for('logout') }}">{{_('üîì Logout')}}</a>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("menuBtn")?.addEventListener("click", () => {
    document.getElementById("sidebar").style.left = "0";
  });

  document.getElementById("closeBtn")?.addEventListener("click", () => {
    document.getElementById("sidebar").style.left = "-250px";
  });
});
const video = document.getElementById('video');
  if (video) {
    navigator.mediaDevices.getUserMedia({video: true}).then(stream => {
      video.srcObject = stream;
    });
  }

  function takePhoto() {
    const canvas = document.getElementById('canvas');
    const video = document.getElementById('video');
    canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
    document.getElementById('selfieInput').value = canvas.toDataURL('image/png');
    alert("{{_('Selfie captured')}}!");
  }

  function validateAndCaptureSelfie() {
    const nameInput = document.getElementById('nameInput');
    let nameValue = nameInput.value.trim();

    // Remove multiple spaces
    nameValue = nameValue.replace(/\s+/g, ' ');

    // Check for only letters and spaces
    const nameRegex = /^[A-Za-z\s]+$/;
    if (!nameRegex.test(nameValue)) {
      alert("Name must contain only letters and spaces.");
      return false;
    }

    // Capitalize each word
    nameValue = nameValue
      .split(" ")
      .map(w => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase())
      .join(" ");

    nameInput.value = nameValue;

    if (!document.getElementById('selfieInput').value) {
      alert("Please capture a selfie!");
      return false;
    }

    return true;
  }
</script>


</body>
</html>